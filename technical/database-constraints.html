<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title></title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.12.1 and GitBook 2.6.7" />

  <meta property="og:title" content="" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="complex-joins-in-the-web-interface.html">
<link rel="next" href="modifying-the-betydb-schema.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="part"><span><b>I Overview</b></span></li>
<li class="chapter" data-level="1" data-path="about-betydb-database-description-and-users-guide.html"><a href="about-betydb-database-description-and-users-guide.html"><i class="fa fa-check"></i><b>1</b> About BETYdb: Database Description and User’s Guide</a><ul>
<li class="chapter" data-level="1.1" data-path="about-betydb-database-description-and-users-guide.html"><a href="about-betydb-database-description-and-users-guide.html#objectives"><i class="fa fa-check"></i><b>1.1</b> Objectives</a></li>
<li class="chapter" data-level="1.2" data-path="about-betydb-database-description-and-users-guide.html"><a href="about-betydb-database-description-and-users-guide.html#scope"><i class="fa fa-check"></i><b>1.2</b> Scope</a></li>
<li class="chapter" data-level="1.3" data-path="about-betydb-database-description-and-users-guide.html"><a href="about-betydb-database-description-and-users-guide.html#content"><i class="fa fa-check"></i><b>1.3</b> Content</a></li>
<li class="chapter" data-level="1.4" data-path="about-betydb-database-description-and-users-guide.html"><a href="about-betydb-database-description-and-users-guide.html#design"><i class="fa fa-check"></i><b>1.4</b> Design</a></li>
<li class="chapter" data-level="1.5" data-path="about-betydb-database-description-and-users-guide.html"><a href="about-betydb-database-description-and-users-guide.html#data-entry"><i class="fa fa-check"></i><b>1.5</b> Data Entry</a></li>
<li class="chapter" data-level="1.6" data-path="about-betydb-database-description-and-users-guide.html"><a href="about-betydb-database-description-and-users-guide.html#software"><i class="fa fa-check"></i><b>1.6</b> Software</a></li>
<li class="chapter" data-level="1.7" data-path="about-betydb-database-description-and-users-guide.html"><a href="about-betydb-database-description-and-users-guide.html#list-of-tables-in-the-bety-database"><i class="fa fa-check"></i><b>1.7</b> List of Tables in the BETY Database</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="betydb-tables.html"><a href="betydb-tables.html"><i class="fa fa-check"></i><b>2</b> BETYdb Tables</a><ul>
<li class="chapter" data-level="2.1" data-path="betydb-tables.html"><a href="betydb-tables.html#schema-enhanced-entity-relationship-model"><i class="fa fa-check"></i><b>2.1</b> Schema: Enhanced Entity-Relationship Model</a></li>
<li class="chapter" data-level="2.2" data-path="betydb-tables.html"><a href="betydb-tables.html#tables"><i class="fa fa-check"></i><b>2.2</b> Tables</a></li>
<li class="chapter" data-level="2.3" data-path="betydb-tables.html"><a href="betydb-tables.html#table-and-field-naming-conventions"><i class="fa fa-check"></i><b>2.3</b> Table and field naming conventions</a><ul>
<li class="chapter" data-level="2.3.1" data-path="betydb-tables.html"><a href="betydb-tables.html#data-tables"><i class="fa fa-check"></i><b>2.3.1</b> Data Tables</a></li>
<li class="chapter" data-level="2.3.2" data-path="betydb-tables.html"><a href="betydb-tables.html#auxillary-tables"><i class="fa fa-check"></i><b>2.3.2</b> Auxillary Tables</a></li>
<li class="chapter" data-level="2.3.3" data-path="betydb-tables.html"><a href="betydb-tables.html#join-tables"><i class="fa fa-check"></i><b>2.3.3</b> Join Tables</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Installing BETYdb</b></span></li>
<li class="chapter" data-level="3" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html"><i class="fa fa-check"></i><b>3</b> Deploying a Production Copy of the BETYdb Web Application</a><ul>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#installing-and-configuring-ruby-and-rails-code"><i class="fa fa-check"></i>Installing and Configuring Ruby and Rails Code</a><ul>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-1-log-in-to-the-deployment-machine-as-an-administrator"><i class="fa fa-check"></i>Step 1: Log in to the deployment machine as an administrator</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-2-add-a-new-user-as-the-owner-of-the-betydb-instance"><i class="fa fa-check"></i>Step 2: Add a new user as the owner of the BETYdb instance</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-3-choose-a-location-for-the-application-code"><i class="fa fa-check"></i>Step 3: Choose a location for the application code</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-4-create-the-target-parent-directory-and-clone-the-betydb-code-from-the-github-repository"><i class="fa fa-check"></i>Step 4: Create the target parent directory and clone the BETYdb code from the GitHub repository:</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-5-if-you-have-not-already-done-so-install-the-correct-version-of-ruby"><i class="fa fa-check"></i>Step 5: If you have not already done so, install the correct version of Ruby</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-6-log-in-to-the-applications-user-account-and-make-sure-you-are-in-the-rails-root-directory"><i class="fa fa-check"></i>Step 6: Log in to the application’s user account and make sure you are in the Rails root directory:</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-7-use-the-bundler-to-install-the-application-gems"><i class="fa fa-check"></i>Step 7: Use the Bundler to install the application Gems:</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-8-create-a-database-configuration-file"><i class="fa fa-check"></i>Step 8: Create a database configuration file</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-9-create-a-rails-application-customization-file"><i class="fa fa-check"></i>Step 9: Create a Rails application customization file</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-10-compile-rails-assets"><i class="fa fa-check"></i>Step 10: Compile Rails assets:</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#loading-the-betydb-database"><i class="fa fa-check"></i>Loading the BETYdb Database</a><ul>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-11-download-the-load.bety.sh-script-from-the-pecan-repository"><i class="fa fa-check"></i>Step 11: Download the load.bety.sh script from the PEcAn repository:</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-12-if-you-arent-already-there-cd-to-the-application-root-directory"><i class="fa fa-check"></i>Step 12: If you aren’t already there, cd to the application root directory:</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-13-log-in-as-user-postgres"><i class="fa fa-check"></i>Step 13: Log in as user postgres:</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-14-create-a-role-and-a-database-for-the-betydb-app"><i class="fa fa-check"></i>Step 14: Create a role and a database for the BETYdb app</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-15-run-the-load.bety.sh-script"><i class="fa fa-check"></i>Step 15: Run the load.bety.sh script:</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-16-optional-load-data-from-another-machine"><i class="fa fa-check"></i>Step 16: (Optional) Load data from another machine:</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-17-exit-the-postgres-user-account"><i class="fa fa-check"></i>Step 17: Exit the postgres user account:</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#complete-apache-and-passenger-configuration"><i class="fa fa-check"></i>Complete Apache and Passenger configuration</a><ul>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-18-check-that-the-correct-version-of-ruby-is-enabled"><i class="fa fa-check"></i>Step 18: Check that the correct version of Ruby is enabled:</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-19-find-the-path-to-the-ruby-interpreter"><i class="fa fa-check"></i>Step 19: Find the path to the Ruby interpreter:</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-20-configure-the-apache-server"><i class="fa fa-check"></i>Step 20: Configure the Apache Server</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-21-restart-apache"><i class="fa fa-check"></i>Step 21: Restart Apache:</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-22-test"><i class="fa fa-check"></i>Step 22: Test:</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#final-steps"><i class="fa fa-check"></i>Final Steps</a><ul>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-23-create-a-betydb-administrative-account"><i class="fa fa-check"></i>Step 23: Create a BETYdb administrative account</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-24-re-set-the-guest-user-account-password"><i class="fa fa-check"></i>Step 24: Re-Set the Guest user account password</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-25-ensure-images-for-priors-pages-are-generated"><i class="fa fa-check"></i>Step 25: Ensure images for Priors pages are generated</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-26-ensure-the-schemaspy-documentation-can-be-generated"><i class="fa fa-check"></i>Step 26: Ensure the SchemaSpy documentation can be generated</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="setting-up-a-centos-server.html"><a href="setting-up-a-centos-server.html"><i class="fa fa-check"></i><b>4</b> Setting Up a CentOS Server</a><ul>
<li class="chapter" data-level="4.1" data-path="setting-up-a-centos-server.html"><a href="setting-up-a-centos-server.html#install-centos-7"><i class="fa fa-check"></i><b>4.1</b> Install CentOS 7</a></li>
<li class="chapter" data-level="4.2" data-path="setting-up-a-centos-server.html"><a href="setting-up-a-centos-server.html#install-additional-system-software"><i class="fa fa-check"></i><b>4.2</b> Install additional system software</a></li>
<li class="chapter" data-level="4.3" data-path="setting-up-a-centos-server.html"><a href="setting-up-a-centos-server.html#install-required-ruby-and-rails-softwareruby_with_rvm"><i class="fa fa-check"></i><b>4.3</b> Install required Ruby and Rails software</a><ul>
<li class="chapter" data-level="4.3.1" data-path="setting-up-a-centos-server.html"><a href="setting-up-a-centos-server.html#rvm-ruby-version-manager"><i class="fa fa-check"></i><b>4.3.1</b> RVM (Ruby Version Manager)</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="setting-up-a-centos-server.html"><a href="setting-up-a-centos-server.html#bundler"><i class="fa fa-check"></i><b>4.4</b> Bundler:</a></li>
<li class="chapter" data-level="4.5" data-path="setting-up-a-centos-server.html"><a href="setting-up-a-centos-server.html#node.js-needed-to-be-able-to-compile-rails-assets"><i class="fa fa-check"></i><b>4.5</b> node.js (needed to be able to compile Rails assets):</a></li>
<li class="chapter" data-level="4.6" data-path="setting-up-a-centos-server.html"><a href="setting-up-a-centos-server.html#phusion-passengerphusion_passenger"><i class="fa fa-check"></i><b>4.6</b> Phusion Passenger</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="configuring-postgresql.html"><a href="configuring-postgresql.html"><i class="fa fa-check"></i><b>5</b> Configuring PostgreSQL</a><ul>
<li class="chapter" data-level="5.1" data-path="configuring-postgresql.html"><a href="configuring-postgresql.html#step-1-initialize-the-database-cluster-and-start-the-server"><i class="fa fa-check"></i><b>5.1</b> Step 1: Initialize the database cluster and start the server</a></li>
<li class="chapter" data-level="5.2" data-path="configuring-postgresql.html"><a href="configuring-postgresql.html#step-2-enable-password-authentication-for-all-users-other-than-postgres"><i class="fa fa-check"></i><b>5.2</b> Step 2: Enable password authentication for all users other than postgres</a></li>
<li class="chapter" data-level="5.3" data-path="configuring-postgresql.html"><a href="configuring-postgresql.html#step-3-create-a-new-role-and-new-database-for-betydb"><i class="fa fa-check"></i><b>5.3</b> Step 3: Create a new role and new database for BETYdb</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="archived-setup-documentation.html"><a href="archived-setup-documentation.html"><i class="fa fa-check"></i><b>6</b> Archived Setup Documentation</a><ul>
<li class="chapter" data-level="6.1" data-path="archived-setup-documentation.html"><a href="archived-setup-documentation.html#setting-up-a-redhat-or-centos-server"><i class="fa fa-check"></i><b>6.1</b> Setting up a RedHat or CentOS Server</a><ul>
<li class="chapter" data-level="6.1.1" data-path="archived-setup-documentation.html"><a href="archived-setup-documentation.html#overview"><i class="fa fa-check"></i><b>6.1.1</b> Overview</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="archived-setup-documentation.html"><a href="archived-setup-documentation.html#instructions-for-installing-and-configuring-postgresql"><i class="fa fa-check"></i><b>6.2</b> Instructions for Installing and Configuring PostgreSQL</a></li>
<li class="chapter" data-level="6.3" data-path="archived-setup-documentation.html"><a href="archived-setup-documentation.html#installing-the-betydb-rails-application"><i class="fa fa-check"></i><b>6.3</b> Installing the BETYdb Rails Application</a><ul>
<li class="chapter" data-level="6.3.1" data-path="archived-setup-documentation.html"><a href="archived-setup-documentation.html#prerequisites"><i class="fa fa-check"></i><b>6.3.1</b> Prerequisites</a></li>
<li class="chapter" data-level="6.3.2" data-path="archived-setup-documentation.html"><a href="archived-setup-documentation.html#installing-the-rails-application"><i class="fa fa-check"></i><b>6.3.2</b> Installing the Rails Application</a></li>
<li class="chapter" data-level="6.3.3" data-path="archived-setup-documentation.html"><a href="archived-setup-documentation.html#updating-syncing-the-database"><i class="fa fa-check"></i><b>6.3.3</b> Updating / Syncing the database</a></li>
<li class="chapter" data-level="6.3.4" data-path="archived-setup-documentation.html"><a href="archived-setup-documentation.html#starting-the-betydb-rails-web-application"><i class="fa fa-check"></i><b>6.3.4</b> Starting the BETYdb Rails Web Application</a></li>
<li class="chapter" data-level="6.3.5" data-path="archived-setup-documentation.html"><a href="archived-setup-documentation.html#logrotation"><i class="fa fa-check"></i><b>6.3.5</b> Logrotation</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III BETYdb System Administration</b></span></li>
<li class="chapter" data-level="7" data-path="updating-betydb-when-new-versions-are-released.html"><a href="updating-betydb-when-new-versions-are-released.html"><i class="fa fa-check"></i><b>7</b> Updating BETYdb When New Versions are Released</a><ul>
<li class="chapter" data-level="7.1" data-path="updating-betydb-when-new-versions-are-released.html"><a href="updating-betydb-when-new-versions-are-released.html#updating-the-bety-database"><i class="fa fa-check"></i><b>7.1</b> Updating the BETY database</a></li>
<li class="chapter" data-level="7.2" data-path="updating-betydb-when-new-versions-are-released.html"><a href="updating-betydb-when-new-versions-are-released.html#update-the-rails-app-and-schema"><i class="fa fa-check"></i><b>7.2</b> Update the Rails app and schema</a></li>
<li class="chapter" data-level="7.3" data-path="updating-betydb-when-new-versions-are-released.html"><a href="updating-betydb-when-new-versions-are-released.html#load-a-fresh-version-of-database"><i class="fa fa-check"></i><b>7.3</b> Load a fresh version of database</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="distributed-instances-of-betydb.html"><a href="distributed-instances-of-betydb.html"><i class="fa fa-check"></i><b>8</b> Distributed instances of BETYdb</a><ul>
<li class="chapter" data-level="8.1" data-path="distributed-instances-of-betydb.html"><a href="distributed-instances-of-betydb.html#syncing-databases"><i class="fa fa-check"></i><b>8.1</b> Syncing Databases</a><ul>
<li class="chapter" data-level="8.1.1" data-path="distributed-instances-of-betydb.html"><a href="distributed-instances-of-betydb.html#exporting-data"><i class="fa fa-check"></i><b>8.1.1</b> Exporting Data</a></li>
<li class="chapter" data-level="8.1.2" data-path="distributed-instances-of-betydb.html"><a href="distributed-instances-of-betydb.html#importing-data"><i class="fa fa-check"></i><b>8.1.2</b> Importing Data</a></li>
<li class="chapter" data-level="8.1.3" data-path="distributed-instances-of-betydb.html"><a href="distributed-instances-of-betydb.html#primary-key-allocations"><i class="fa fa-check"></i><b>8.1.3</b> Primary Key Allocations</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="distributed-instances-of-betydb.html"><a href="distributed-instances-of-betydb.html#feedback-tab"><i class="fa fa-check"></i><b>8.2</b> Feedback Tab</a></li>
<li class="chapter" data-level="8.3" data-path="distributed-instances-of-betydb.html"><a href="distributed-instances-of-betydb.html#customization"><i class="fa fa-check"></i><b>8.3</b> Customization</a></li>
<li class="chapter" data-level="8.4" data-path="distributed-instances-of-betydb.html"><a href="distributed-instances-of-betydb.html#issues"><i class="fa fa-check"></i><b>8.4</b> Issues</a></li>
</ul></li>
<li class="part"><span><b>IV BETYdb Development</b></span></li>
<li class="chapter" data-level="9" data-path="ruby-on-rails-application-overview-draft.html"><a href="ruby-on-rails-application-overview-draft.html"><i class="fa fa-check"></i><b>9</b> Ruby on Rails Application Overview (draft)</a><ul>
<li class="chapter" data-level="9.1" data-path="ruby-on-rails-application-overview-draft.html"><a href="ruby-on-rails-application-overview-draft.html#introduction-to-ruby-on-rails"><i class="fa fa-check"></i><b>9.1</b> Introduction to Ruby-on-Rails</a></li>
<li class="chapter" data-level="9.2" data-path="ruby-on-rails-application-overview-draft.html"><a href="ruby-on-rails-application-overview-draft.html#introduction-to-mvc"><i class="fa fa-check"></i><b>9.2</b> Introduction to MVC</a></li>
<li class="chapter" data-level="9.3" data-path="ruby-on-rails-application-overview-draft.html"><a href="ruby-on-rails-application-overview-draft.html#source-code-map"><i class="fa fa-check"></i><b>9.3</b> Source Code Map</a></li>
<li class="chapter" data-level="9.4" data-path="ruby-on-rails-application-overview-draft.html"><a href="ruby-on-rails-application-overview-draft.html#misc.-information"><i class="fa fa-check"></i><b>9.4</b> Misc. Information</a><ul>
<li class="chapter" data-level="9.4.1" data-path="ruby-on-rails-application-overview-draft.html"><a href="ruby-on-rails-application-overview-draft.html#providing-model-output-for-download"><i class="fa fa-check"></i><b>9.4.1</b> Providing model output for download</a></li>
<li class="chapter" data-level="9.4.2" data-path="ruby-on-rails-application-overview-draft.html"><a href="ruby-on-rails-application-overview-draft.html#related-issues-commits"><i class="fa fa-check"></i><b>9.4.2</b> Related Issues / Commits:</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="ruby-on-rails-developing-upgrading-and-deploying.html"><a href="ruby-on-rails-developing-upgrading-and-deploying.html"><i class="fa fa-check"></i><b>10</b> Ruby-on-Rails: Developing, Upgrading, and Deploying</a><ul>
<li class="chapter" data-level="10.1" data-path="ruby-on-rails-developing-upgrading-and-deploying.html"><a href="ruby-on-rails-developing-upgrading-and-deploying.html#development-and-testing"><i class="fa fa-check"></i><b>10.1</b> Development and Testing</a></li>
<li class="chapter" data-level="10.2" data-path="ruby-on-rails-developing-upgrading-and-deploying.html"><a href="ruby-on-rails-developing-upgrading-and-deploying.html#deploying-a-new-version"><i class="fa fa-check"></i><b>10.2</b> Deploying a new version:</a></li>
<li class="chapter" data-level="10.3" data-path="ruby-on-rails-developing-upgrading-and-deploying.html"><a href="ruby-on-rails-developing-upgrading-and-deploying.html#deploying-or-upgrading-to-a-new-version-of-the-betydb-rails-app"><i class="fa fa-check"></i><b>10.3</b> Deploying or upgrading to a new version of the BETYdb Rails app</a><ul>
<li class="chapter" data-level="10.3.1" data-path="ruby-on-rails-developing-upgrading-and-deploying.html"><a href="ruby-on-rails-developing-upgrading-and-deploying.html#running-migrations"><i class="fa fa-check"></i><b>10.3.1</b> Running Migrations</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="ruby-on-rails-developing-upgrading-and-deploying.html"><a href="ruby-on-rails-developing-upgrading-and-deploying.html#versioning-and-tagging"><i class="fa fa-check"></i><b>10.4</b> Versioning and Tagging</a><ul>
<li class="chapter" data-level="10.4.1" data-path="ruby-on-rails-developing-upgrading-and-deploying.html"><a href="ruby-on-rails-developing-upgrading-and-deploying.html#protocol-for-defining-and-releasing-versions"><i class="fa fa-check"></i><b>10.4.1</b> Protocol for defining and releasing versions</a></li>
<li class="chapter" data-level="10.4.2" data-path="ruby-on-rails-developing-upgrading-and-deploying.html"><a href="ruby-on-rails-developing-upgrading-and-deploying.html#version-numbering"><i class="fa fa-check"></i><b>10.4.2</b> Version Numbering</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="ruby-on-rails-developing-upgrading-and-deploying.html"><a href="ruby-on-rails-developing-upgrading-and-deploying.html#commenting-in-the-rails-models"><i class="fa fa-check"></i><b>10.5</b> Commenting in the Rails Models</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="automated-tests.html"><a href="automated-tests.html"><i class="fa fa-check"></i><b>11</b> Automated Tests</a><ul>
<li class="chapter" data-level="11.1" data-path="automated-tests.html"><a href="automated-tests.html#development-and-testing-1"><i class="fa fa-check"></i><b>11.1</b> Development and Testing</a></li>
<li class="chapter" data-level="11.2" data-path="automated-tests.html"><a href="automated-tests.html#running-the-rspec-tests-on-betydb."><i class="fa fa-check"></i><b>11.2</b> Running the RSpec tests on BETYdb.</a><ul>
<li class="chapter" data-level="11.2.1" data-path="automated-tests.html"><a href="automated-tests.html#preparing-the-test-database."><i class="fa fa-check"></i><b>11.2.1</b> Preparing the test database.</a></li>
<li class="chapter" data-level="11.2.2" data-path="automated-tests.html"><a href="automated-tests.html#running-the-tests"><i class="fa fa-check"></i><b>11.2.2</b> Running the tests</a></li>
<li class="chapter" data-level="11.2.3" data-path="automated-tests.html"><a href="automated-tests.html#troubleshooting"><i class="fa fa-check"></i><b>11.2.3</b> Troubleshooting</a></li>
<li class="chapter" data-level="11.2.4" data-path="automated-tests.html"><a href="automated-tests.html#creating-a-new-postgis-enabled-database-template"><i class="fa fa-check"></i><b>11.2.4</b> Creating a new PostGIS-enabled database template</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="code-style.html"><a href="code-style.html"><i class="fa fa-check"></i><b>12</b> Code Style</a><ul>
<li class="chapter" data-level="12.1" data-path="code-style.html"><a href="code-style.html#whitespace-conventions-in-the-betydb-code"><i class="fa fa-check"></i><b>12.1</b> Whitespace conventions in the BETYdb Code</a></li>
<li class="chapter" data-level="12.2" data-path="code-style.html"><a href="code-style.html#fixing-legacy-formatting"><i class="fa fa-check"></i><b>12.2</b> Fixing legacy formatting</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="complex-joins-in-the-web-interface.html"><a href="complex-joins-in-the-web-interface.html"><i class="fa fa-check"></i><b>13</b> Complex Joins in the Web Interface</a></li>
<li class="chapter" data-level="14" data-path="database-constraints.html"><a href="database-constraints.html"><i class="fa fa-check"></i><b>14</b> Database Constraints</a><ul>
<li class="chapter" data-level="14.1" data-path="database-constraints.html"><a href="database-constraints.html#types-of-constraints"><i class="fa fa-check"></i><b>14.1</b> Types of Constraints</a></li>
<li class="chapter" data-level="14.2" data-path="database-constraints.html"><a href="database-constraints.html#value-constraints-including-some-not-null-constraints"><i class="fa fa-check"></i><b>14.2</b> Value Constraints (including some NOT NULL constraints)</a><ul>
<li class="chapter" data-level="" data-path="database-constraints.html"><a href="database-constraints.html#global"><i class="fa fa-check"></i>Global</a></li>
<li class="chapter" data-level="" data-path="database-constraints.html"><a href="database-constraints.html#covariates-1"><i class="fa fa-check"></i>covariates:</a></li>
<li class="chapter" data-level="" data-path="database-constraints.html"><a href="database-constraints.html#managements-1"><i class="fa fa-check"></i>managements:</a></li>
<li class="chapter" data-level="" data-path="database-constraints.html"><a href="database-constraints.html#species"><i class="fa fa-check"></i>species:</a></li>
<li class="chapter" data-level="" data-path="database-constraints.html"><a href="database-constraints.html#sites-1"><i class="fa fa-check"></i>sites:</a></li>
<li class="chapter" data-level="" data-path="database-constraints.html"><a href="database-constraints.html#traits-1"><i class="fa fa-check"></i>traits:</a></li>
<li class="chapter" data-level="" data-path="database-constraints.html"><a href="database-constraints.html#treatments-1"><i class="fa fa-check"></i>treatments:</a></li>
<li class="chapter" data-level="" data-path="database-constraints.html"><a href="database-constraints.html#users"><i class="fa fa-check"></i>users:</a></li>
<li class="chapter" data-level="" data-path="database-constraints.html"><a href="database-constraints.html#yields-see-also-traits-constraints"><i class="fa fa-check"></i>yields: [see also traits constraints]</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="database-constraints.html"><a href="database-constraints.html#foreign-key-constraints"><i class="fa fa-check"></i><b>14.3</b> Foreign Key Constraints</a></li>
<li class="chapter" data-level="14.4" data-path="database-constraints.html"><a href="database-constraints.html#non-null-constraints"><i class="fa fa-check"></i><b>14.4</b> Non Null Constraints</a></li>
<li class="chapter" data-level="14.5" data-path="database-constraints.html"><a href="database-constraints.html#uniqueness-constraints"><i class="fa fa-check"></i><b>14.5</b> Uniqueness constraints</a></li>
<li class="chapter" data-level="14.6" data-path="database-constraints.html"><a href="database-constraints.html#technical-note"><i class="fa fa-check"></i><b>14.6</b> Technical Note</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="modifying-the-betydb-schema.html"><a href="modifying-the-betydb-schema.html"><i class="fa fa-check"></i><b>15</b> Modifying the BETYdb schema</a><ul>
<li class="chapter" data-level="15.1" data-path="modifying-the-betydb-schema.html"><a href="modifying-the-betydb-schema.html#modifying-bety-troubleshooting"><i class="fa fa-check"></i><b>15.1</b> Troubleshooting</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="issuing-a-new-release.html"><a href="issuing-a-new-release.html"><i class="fa fa-check"></i><b>16</b> Issuing a New Release</a><ul>
<li class="chapter" data-level="16.1" data-path="issuing-a-new-release.html"><a href="issuing-a-new-release.html#writing-release-notes"><i class="fa fa-check"></i><b>16.1</b> Writing release notes</a></li>
<li class="chapter" data-level="16.2" data-path="issuing-a-new-release.html"><a href="issuing-a-new-release.html#upgrading-the-canonical-betydb-rails-sitecanonical_site"><i class="fa fa-check"></i><b>16.2</b> Upgrading the canonical BETYdb Rails site</a></li>
<li class="chapter" data-level="16.3" data-path="issuing-a-new-release.html"><a href="issuing-a-new-release.html#upgrading-other-production-sites"><i class="fa fa-check"></i><b>16.3</b> Upgrading other production sites</a></li>
<li class="chapter" data-level="16.4" data-path="issuing-a-new-release.html"><a href="issuing-a-new-release.html#finishing-the-release"><i class="fa fa-check"></i><b>16.4</b> Finishing the release</a><ul>
<li class="chapter" data-level="16.4.1" data-path="issuing-a-new-release.html"><a href="issuing-a-new-release.html#version-numbering-1"><i class="fa fa-check"></i><b>16.4.1</b> Version Numbering</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>V Appendix</b></span></li>
<li class="chapter" data-level="" data-path="release-notes-template.html"><a href="release-notes-template.html"><i class="fa fa-check"></i>Release Notes Template</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="database-constraints" class="section level1">
<h1><span class="header-section-number">14</span> Database Constraints</h1>
<p>BETYdb contains database level constraints. Building constraints into the SQL schema provides a way of explicitly defining the meaning of the database model and its intended functionality.</p>
<div id="types-of-constraints" class="section level2">
<h2><span class="header-section-number">14.1</span> Types of Constraints</h2>
<ol style="list-style-type: decimal">
<li><strong>Value</strong> constraints include:
<ul>
<li>range constraints on continuous variables</li>
<li>“enum” constraints on, for example, state or country designations; this is a form of normalization (“US” and “USA” should be folded into a common designation); forms utilized by SELECT controls should perhaps be favored</li>
<li>consistency constraints: for example <code>(year, month, day)</code> can’t be <code>(2001, 2, 29)</code>; or the city, state, and country specified for a site should be consistent with the latitude and longitude; (this may be hard to check, but some level of checking may not be too difficult: for example, <code>SELECT * FROM sites WHERE country IN ('US', 'United States', 'USA') AND lon &gt; 0;</code> shouldn’t return any rows)</li>
</ul></li>
<li><strong>Foreign key</strong> constraints
<ul>
<li>Prevents accidental deletion of meta-data records in lookup tables</li>
<li>Prevents entry of primary data without contextual information required to interpret the data</li>
</ul></li>
<li><strong>Non-NULL</strong> constraints
<ul>
<li>Constrains which fields can not be empty</li>
</ul></li>
<li><strong>Uniqueness</strong> constraints
<ul>
<li>These define what makes a row unique, by designating a ‘natural key’ - a combination of fields that make a row unique (distinct from primary keys that are used in cross-table joins).</li>
</ul></li>
</ol>
<p>All constraints are defined in the database schema, <a href="https://github.com/PecanProject/bety/blob/master/db/structure.sql" target="_blank"><code>db/structure.sql</code></a></p>
</div>
<div id="value-constraints-including-some-not-null-constraints" class="section level2">
<h2><span class="header-section-number">14.2</span> Value Constraints (including some NOT NULL constraints)</h2>
<div id="global" class="section level3 unnumbered">
<h3>Global</h3>
<ul>
<li>Text fields should not have leading or trailing white spaces. (Are there any fields for which this is not the case?)<br />
This can be checked with <code>CHECK(TRIM(FROM &lt;columnname&gt;) = &lt;columnname&gt;)</code> Probably sequences of two or more consecutive whitespace characters should be forbidden as well except for various free-form textual columns such as <code>traits.notes</code>. This can be checked with <code>CHECK(REGEXP_REPLACE(TRIM(FROM &lt;columnname&gt;), ' +', ' ') = &lt;columnname&gt;)</code> For convenience, we should probably define a function so we can just do something like <code>CHECK(is_normalized(&lt;columnname&gt;))</code> .</li>
</ul>
</div>
<div id="covariates-1" class="section level3 unnumbered">
<h3>covariates:</h3>
<ul>
<li>Check that <code>level</code> is in the range corresponding to variable referenced by <code>variable_id</code>.</li>
<li>Check that <code>n</code> is positive (or &gt; 1 ?) if it is not NULL.</li>
<li>Check that <code>statname</code> and <code>stat</code> are either both NULL or both non-NULL. (Alternatively, ensure that <code>statname</code> is non-NULL and that it equals the empty string if and only if <code>stat</code> is NULL.)</li>
<li>Check that <code>statname</code> is one of “SD”, “SE”, “MSE”, “95%CI”, “LSD”, “MSD” or possibly “”. Consider creating an ENUM data type for this.</li>
</ul>
</div>
<div id="managements-1" class="section level3 unnumbered">
<h3>managements:</h3>
<ul>
<li>mgmttype: Constrain to one of the values in the web interface’s dropdown. (Is there any reason not to store these in the variables table, or in a separate lookup table? If we record units and range restrictions, this would be useful. On the other hand, if we continue to use a static list of management types, we should create a new ENUM type in the database to enumerate the allowed values.</li>
<li>level: This should always be non-negative (except in the case that we want to use the special value -999 for mgmttypes where a level has no meaning; if so, we should also constrain level to be non-NULL).</li>
<li>units: Should be constrained to a known set of values—in fact, on a per mgmttype basis; currently there are several varying designations for the same unit in a number of cases</li>
<li>dateloc: Should be constrained to specific values. Since there is a value (9) designated as meaning “no data”, this column should be constrained to be NOT NULL. We should perhaps constraint this column to have this value if <code>date</code> is NULL.</li>
<li>All values of citation_id in managements should also be associated with treatment via citations_treatments table. Does thie mean: The management should be associated with (at least) one of the treatments associated with the citation specified by <code>citation_id</code>?</li>
</ul>
</div>
<div id="species" class="section level3 unnumbered">
<h3>species:</h3>
<ul>
<li>Ensure scientificname LIKE CONCAT(genus, ‘‘, species, ‘%’)</li>
<li>Ensure genus is capitalized (and consists of a single word?).</li>
</ul>
</div>
<div id="sites-1" class="section level3 unnumbered">
<h3>sites:</h3>
<ul>
<li>lat (replaced by geometry)</li>
<li>lon (replaced by geometry)</li>
<li>som: 0 – 100</li>
<li>mat: range: -50, 150</li>
<li>masl: (replaced by geometry)</li>
<li>map: Minimum is zero. Maximum = ?</li>
<li>local_time: Range should be -12 to +12. This might more aptly be called timezone. A comment should clarify the meaning; I assume it should mean something like “the number of hours local standard time is ahead of GMT”. Some kind of check might be possible to ensure consistence with the longitude.</li>
<li>sand_pct, clay_pct: These both have range 0–100, and sand_pct + clay_pct should be &lt;= 100.</li>
<li>sitename: Unique and non-null (see below); also, ensure it does not have leading or trailing white space and no internal sequences of 2 or more consecutive spaces. This will make the uniqueness constraint more meaningful. (A similar white space constraint should apply to all textual keys in all tables.)</li>
</ul>
</div>
<div id="traits-1" class="section level3 unnumbered">
<h3>traits:</h3>
<p>It isn’t clear what a natural key would be, but it would probably involve several foreign key columns. Perhaps (site_id, specie_id, cultivar_id, treatment_id, variable_id, and some combination of date and time fields. But it is important to have some sort of uniqueness constraint other than just the default unique-id constraint. For example, if the web-interface user accidentally presses the Create button on the New Trait page twice, two essentially equal trait rows will be created (they will differ only in the id and timestamp columns). See Uniqueness Constraints below!</p>
<ul>
<li>date, dateloc, time, timeloc, date_year, date_month, date_day, time_hour, time_minute: Check date and time fields consistency: For example, if dateloc is 91—97, date and date_year should both be NULL (but maybe old data doesn’t adhere to this?). If date_year, date_month, or date_day is NULL, date should be NULL as well. Also, dateloc and timeloc should be constrained to certain meaningful values. (See comment above on managements.dateloc.)</li>
<li>mean: Check mean is in the range corresponding to the variable referenced by variable_id.</li>
<li>n, stat, statname: n should always be positive; if n = 1, statname should be NULL. statname should be one of a specified set of values. (See comments above on covariates.stat and covariates.statname.)</li>
<li>specie_id and cultivar_id need to be consistent with one another.</li>
<li>access_level: Range is 1–4.</li>
</ul>
</div>
<div id="treatments-1" class="section level3 unnumbered">
<h3>treatments:</h3>
<ul>
<li>name: Possibly standardize capitalization of names (easiest would be to have all words in all names not capitalized except for proper names and unit names where appropriate; this would convey the most information because (e.g.) author names would stand out from other words). This would need to be done manually to avoid converting proper names to lowercase. As stated below, names should be unique within a citation and site pair; standardizing capitalization will make this constraint more meaningful.</li>
<li>definition: Treat captitalization similarly to that for names.</li>
<li>control: There can be more than one control treatment per citation (currently there are). Below in the uniqueness section, it is stated that there can be only one control for a given citation <em>and site</em>.</li>
<li>Since (as stated below) names should be unique within a citation and site pair, standardizing capitalization will make this constraint more meaningful.</li>
</ul>
</div>
<div id="users" class="section level3 unnumbered">
<h3>users:</h3>
<ul>
<li>login: Enforce any constraints required by the Rails interface.</li>
<li>email: Constrain to valid email addresses.</li>
<li>country: Constrain to valid country names.</li>
<li>area: This currently isn’t very meaningful. Perhaps this should be an ENUM. Alteratively, it could be constraint to be some category word followed by free-form text.</li>
<li>access_level: Range is 1 - 4.</li>
<li>page_access_level: Range is 1 - 4.</li>
<li>postal_code: Ideally, this should be constrained according to the country. Since most users are (currently) from the U.S., we could at least constraint U.S. postal codes to “NNNNNN” or “NNNNNN-NNNN”.</li>
</ul>
</div>
<div id="yields-see-also-traits-constraints" class="section level3 unnumbered">
<h3>yields: [see also traits constraints]</h3>
<ul>
<li>mean: mean should be in the range of plausible yield values.</li>
</ul>
</div>
</div>
<div id="foreign-key-constraints" class="section level2">
<h2><span class="header-section-number">14.3</span> Foreign Key Constraints</h2>
<p>All foreign key constraints follow the form <code>table_id references tables</code>, following Ruby style conventions.</p>
<p>A <a href="https://gist.github.com/dlebauer/12d8d9ed1b2965301d64" target="_blank">Github Gist</a> contains a list of foreign key constraints to be placed on BETYdb. The foreign keys are often named using the form <code>fk_foreigntable_lookuptable_1</code> where the foreigntable has the foreign key.</p>
</div>
<div id="non-null-constraints" class="section level2">
<h2><span class="header-section-number">14.4</span> Non Null Constraints</h2>
<p>This is a list of fields that should not be allowed to be null. In all cases, the primary key should not be null. For many-to-many relationship tables, the foreign keys should be non-null.</p>
<ul>
<li>citations: author, year, title</li>
<li>covariates: trait_id, variable_id</li>
<li>cultivars: specie_id, name</li>
<li>dbfiles: file_name, file_path, container_type, container_id, machine_id</li>
<li>ensembles: workflow_id</li>
<li>formats: dataformat</li>
<li>formats_variables: ?</li>
<li>inputs: name, access_level, format_id</li>
<li>likelihoods: run_id, variable_id, input_id</li>
<li>machines: hostname</li>
<li>managements: date, management_type</li>
<li>methods: name, description, citation_id</li>
<li>models: model_name, model_path, revision, model_type</li>
<li>pfts: definition, name</li>
<li>posteriors: pft_id, format_id</li>
<li>priors: phylogeny, variable_id, distn, parama, paramb</li>
<li>runs: model_id, site_id, start_time, finish_time, outdir, outprefix, setting, parameter_list, started_at, ensemble_id (note: finished_at will not be available when record is created)</li>
<li>sites: lat, lon, sitename, greenhouse</li>
<li>species: genus, species, scientificname</li>
<li>traits: specie_id, citation_id, treatment_id, mean, variable_id, checked, access_level</li>
<li>treatments: name, control</li>
<li>users: login, name, email, crypted_password, salt, access_level, page_access_level, apikey</li>
<li>variables: namem, units</li>
<li>workflows: folder, started_at, site_id, model_id, hostname, params, advanced_edit, start_date, end_date</li>
<li>yields: specie_id, citation_id, treatment_id, mean, variable_id, checked, access_level</li>
</ul>
</div>
<div id="uniqueness-constraints" class="section level2">
<h2><span class="header-section-number">14.5</span> Uniqueness constraints</h2>
<p>Uniqueness constraints are “natural keys”, i.e. combinations of fields that should be unique within a table. Ideally, each table would have a natural key, but a table may have 0, 1, or many uniqueness constraints.</p>
<p>For many-to-many relationship tables, the foreign key pairs should be unique; these should be implemented but are not listed here for brevity.</p>
<ul>
<li>citations: author, year, title</li>
<li>covariates: trait_id, variable_id</li>
<li>cultivars: specie_id, name</li>
<li>dbfiles: file_name, file_path, machine_id</li>
<li>dbfiles: container_type, container_id</li>
<li>formats_variables: ?</li>
<li>formats: site_id, start_date, end_date, format_id</li>
<li>likelihoods: run_id, variable_id, input_id</li>
<li>machines: hostname</li>
<li>managements: date, management_type</li>
<li>methods: name, citation_id</li>
<li>models: model_path</li>
<li>pfts: name</li>
<li>posteriors: pft_id</li>
<li>priors: phylogeny, variable_id, distn, parama, paramb</li>
<li>priors: phylogeny, variable_id, notes</li>
<li>runs: (?) model_id, site_id, start_time, finish_time, parameter_list, ensemble_id</li>
<li>sites: lat, lon, sitename</li>
<li>species: scientificname (not genus, species because there may be multiple varieties)</li>
<li>traits: site_id, specie_id, citation_id, cultivar_id, treatment_id, date, time, variable_id, entity_id, method_id, date_year, date_month, date_day, time_hour, time_minute</li>
<li>treatments:</li>
<li>for a given citation, name should be unique;</li>
<li>for a given citation and site, there should be only one control</li>
<li>users: (each of the following fields should be independently unique from other records)</li>
<li>login</li>
<li>email</li>
<li>crypted_password</li>
<li>salt</li>
<li>apikey</li>
<li>variables: name</li>
<li>workflows: site_id, model_id, params, advanced_edit, start_date, end_date</li>
<li>yields: site_id, specie_id, citation_id, cultivar_id, treatment_id, date, entity_id, method_id, date_year, date_month, date_day</li>
</ul>
</div>
<div id="technical-note" class="section level2">
<h2><span class="header-section-number">14.6</span> Technical Note</h2>
<p><strong>Database level constraints violates Ruby’s “Active Record”</strong> approach.</p>
<p>The <a href="http://guides.rubyonrails.org/migrations.html#active-record-and-referential-integrity" target="_blank">Rail Guide on Database Migrations</a> suggests</p>
<blockquote>
<p>The Active Record way claims that intelligence belongs in your models, not in the database. As such, features such as triggers or foreign key constraints, which push some of that intelligence back into the database, are not heavily used.</p>
</blockquote>
<p>In order to add database constraints we moved from using <code>db/schema.rb</code> to <code>db/structure.sql</code>, so that the schema is stored in SQL rather than in Ruby.</p>
<p>Given that the Ruby web application is only one of the ways in which we use the database, it seems reasonable to go with the SQL database-level constraints.</p>
<p>The <code>db/structure.sql</code> approach is more straightforward, allows the database to exist independently of its Rails framework, and provides more flexibility.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="complex-joins-in-the-web-interface.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="modifying-the-betydb-schema.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
