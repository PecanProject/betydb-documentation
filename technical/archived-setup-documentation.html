<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title></title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.12.1 and GitBook 2.6.7" />

  <meta property="og:title" content="" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="configuring-postgresql.html">
<link rel="next" href="updating-betydb-when-new-versions-are-released.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="part"><span><b>I Overview</b></span></li>
<li class="chapter" data-level="1" data-path="about-betydb-database-description-and-users-guide.html"><a href="about-betydb-database-description-and-users-guide.html"><i class="fa fa-check"></i><b>1</b> About BETYdb: Database Description and User’s Guide</a><ul>
<li class="chapter" data-level="1.1" data-path="about-betydb-database-description-and-users-guide.html"><a href="about-betydb-database-description-and-users-guide.html#objectives"><i class="fa fa-check"></i><b>1.1</b> Objectives</a></li>
<li class="chapter" data-level="1.2" data-path="about-betydb-database-description-and-users-guide.html"><a href="about-betydb-database-description-and-users-guide.html#scope"><i class="fa fa-check"></i><b>1.2</b> Scope</a></li>
<li class="chapter" data-level="1.3" data-path="about-betydb-database-description-and-users-guide.html"><a href="about-betydb-database-description-and-users-guide.html#content"><i class="fa fa-check"></i><b>1.3</b> Content</a></li>
<li class="chapter" data-level="1.4" data-path="about-betydb-database-description-and-users-guide.html"><a href="about-betydb-database-description-and-users-guide.html#design"><i class="fa fa-check"></i><b>1.4</b> Design</a></li>
<li class="chapter" data-level="1.5" data-path="about-betydb-database-description-and-users-guide.html"><a href="about-betydb-database-description-and-users-guide.html#data-entry"><i class="fa fa-check"></i><b>1.5</b> Data Entry</a></li>
<li class="chapter" data-level="1.6" data-path="about-betydb-database-description-and-users-guide.html"><a href="about-betydb-database-description-and-users-guide.html#software"><i class="fa fa-check"></i><b>1.6</b> Software</a></li>
<li class="chapter" data-level="1.7" data-path="about-betydb-database-description-and-users-guide.html"><a href="about-betydb-database-description-and-users-guide.html#list-of-tables-in-the-bety-database"><i class="fa fa-check"></i><b>1.7</b> List of Tables in the BETY Database</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="betydb-tables.html"><a href="betydb-tables.html"><i class="fa fa-check"></i><b>2</b> BETYdb Tables</a><ul>
<li class="chapter" data-level="2.1" data-path="betydb-tables.html"><a href="betydb-tables.html#schema-enhanced-entity-relationship-model"><i class="fa fa-check"></i><b>2.1</b> Schema: Enhanced Entity-Relationship Model</a></li>
<li class="chapter" data-level="2.2" data-path="betydb-tables.html"><a href="betydb-tables.html#tables"><i class="fa fa-check"></i><b>2.2</b> Tables</a></li>
<li class="chapter" data-level="2.3" data-path="betydb-tables.html"><a href="betydb-tables.html#table-and-field-naming-conventions"><i class="fa fa-check"></i><b>2.3</b> Table and field naming conventions</a><ul>
<li class="chapter" data-level="2.3.1" data-path="betydb-tables.html"><a href="betydb-tables.html#data-tables"><i class="fa fa-check"></i><b>2.3.1</b> Data Tables</a></li>
<li class="chapter" data-level="2.3.2" data-path="betydb-tables.html"><a href="betydb-tables.html#auxillary-tables"><i class="fa fa-check"></i><b>2.3.2</b> Auxillary Tables</a></li>
<li class="chapter" data-level="2.3.3" data-path="betydb-tables.html"><a href="betydb-tables.html#join-tables"><i class="fa fa-check"></i><b>2.3.3</b> Join Tables</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Installing BETYdb</b></span></li>
<li class="chapter" data-level="3" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html"><i class="fa fa-check"></i><b>3</b> Deploying a Production Copy of the BETYdb Web Application</a><ul>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#installing-and-configuring-ruby-and-rails-code"><i class="fa fa-check"></i>Installing and Configuring Ruby and Rails Code</a><ul>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-1-log-in-to-the-deployment-machine-as-an-administrator"><i class="fa fa-check"></i>Step 1: Log in to the deployment machine as an administrator</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-2-add-a-new-user-as-the-owner-of-the-betydb-instance"><i class="fa fa-check"></i>Step 2: Add a new user as the owner of the BETYdb instance</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-3-choose-a-location-for-the-application-code"><i class="fa fa-check"></i>Step 3: Choose a location for the application code</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-4-create-the-target-parent-directory-and-clone-the-betydb-code-from-the-github-repository"><i class="fa fa-check"></i>Step 4: Create the target parent directory and clone the BETYdb code from the GitHub repository:</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-5-if-you-have-not-already-done-so-install-the-correct-version-of-ruby"><i class="fa fa-check"></i>Step 5: If you have not already done so, install the correct version of Ruby</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-6-log-in-to-the-applications-user-account-and-make-sure-you-are-in-the-rails-root-directory"><i class="fa fa-check"></i>Step 6: Log in to the application’s user account and make sure you are in the Rails root directory:</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-7-use-the-bundler-to-install-the-application-gems"><i class="fa fa-check"></i>Step 7: Use the Bundler to install the application Gems:</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-8-create-a-database-configuration-file"><i class="fa fa-check"></i>Step 8: Create a database configuration file</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-9-create-a-rails-application-customization-file"><i class="fa fa-check"></i>Step 9: Create a Rails application customization file</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-10-compile-rails-assets"><i class="fa fa-check"></i>Step 10: Compile Rails assets:</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#loading-the-betydb-database"><i class="fa fa-check"></i>Loading the BETYdb Database</a><ul>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-11-download-the-load.bety.sh-script-from-the-pecan-repository"><i class="fa fa-check"></i>Step 11: Download the load.bety.sh script from the PEcAn repository:</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-12-if-you-arent-already-there-cd-to-the-application-root-directory"><i class="fa fa-check"></i>Step 12: If you aren’t already there, cd to the application root directory:</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-13-log-in-as-user-postgres"><i class="fa fa-check"></i>Step 13: Log in as user postgres:</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-14-create-a-role-and-a-database-for-the-betydb-app"><i class="fa fa-check"></i>Step 14: Create a role and a database for the BETYdb app</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-15-run-the-load.bety.sh-script"><i class="fa fa-check"></i>Step 15: Run the load.bety.sh script:</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-16-optional-load-data-from-another-machine"><i class="fa fa-check"></i>Step 16: (Optional) Load data from another machine:</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-17-exit-the-postgres-user-account"><i class="fa fa-check"></i>Step 17: Exit the postgres user account:</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#complete-apache-and-passenger-configuration"><i class="fa fa-check"></i>Complete Apache and Passenger configuration</a><ul>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-18-check-that-the-correct-version-of-ruby-is-enabled"><i class="fa fa-check"></i>Step 18: Check that the correct version of Ruby is enabled:</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-19-find-the-path-to-the-ruby-interpreter"><i class="fa fa-check"></i>Step 19: Find the path to the Ruby interpreter:</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-20-configure-the-apache-server"><i class="fa fa-check"></i>Step 20: Configure the Apache Server</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-21-restart-apache"><i class="fa fa-check"></i>Step 21: Restart Apache:</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-22-test"><i class="fa fa-check"></i>Step 22: Test:</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#final-steps"><i class="fa fa-check"></i>Final Steps</a><ul>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-23-create-a-betydb-administrative-account"><i class="fa fa-check"></i>Step 23: Create a BETYdb administrative account</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-24-re-set-the-guest-user-account-password"><i class="fa fa-check"></i>Step 24: Re-Set the Guest user account password</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-25-ensure-images-for-priors-pages-are-generated"><i class="fa fa-check"></i>Step 25: Ensure images for Priors pages are generated</a></li>
<li class="chapter" data-level="" data-path="deploying-a-production-copy-of-the-betydb-web-application.html"><a href="deploying-a-production-copy-of-the-betydb-web-application.html#step-26-ensure-the-schemaspy-documentation-can-be-generated"><i class="fa fa-check"></i>Step 26: Ensure the SchemaSpy documentation can be generated</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="setting-up-a-centos-server.html"><a href="setting-up-a-centos-server.html"><i class="fa fa-check"></i><b>4</b> Setting Up a CentOS Server</a><ul>
<li class="chapter" data-level="4.1" data-path="setting-up-a-centos-server.html"><a href="setting-up-a-centos-server.html#install-centos-7"><i class="fa fa-check"></i><b>4.1</b> Install CentOS 7</a></li>
<li class="chapter" data-level="4.2" data-path="setting-up-a-centos-server.html"><a href="setting-up-a-centos-server.html#install-additional-system-software"><i class="fa fa-check"></i><b>4.2</b> Install additional system software</a></li>
<li class="chapter" data-level="4.3" data-path="setting-up-a-centos-server.html"><a href="setting-up-a-centos-server.html#install-required-ruby-and-rails-softwareruby_with_rvm"><i class="fa fa-check"></i><b>4.3</b> Install required Ruby and Rails software</a><ul>
<li class="chapter" data-level="4.3.1" data-path="setting-up-a-centos-server.html"><a href="setting-up-a-centos-server.html#rvm-ruby-version-manager"><i class="fa fa-check"></i><b>4.3.1</b> RVM (Ruby Version Manager)</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="setting-up-a-centos-server.html"><a href="setting-up-a-centos-server.html#bundler"><i class="fa fa-check"></i><b>4.4</b> Bundler:</a></li>
<li class="chapter" data-level="4.5" data-path="setting-up-a-centos-server.html"><a href="setting-up-a-centos-server.html#node.js-needed-to-be-able-to-compile-rails-assets"><i class="fa fa-check"></i><b>4.5</b> node.js (needed to be able to compile Rails assets):</a></li>
<li class="chapter" data-level="4.6" data-path="setting-up-a-centos-server.html"><a href="setting-up-a-centos-server.html#phusion-passengerphusion_passenger"><i class="fa fa-check"></i><b>4.6</b> Phusion Passenger</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="configuring-postgresql.html"><a href="configuring-postgresql.html"><i class="fa fa-check"></i><b>5</b> Configuring PostgreSQL</a><ul>
<li class="chapter" data-level="5.1" data-path="configuring-postgresql.html"><a href="configuring-postgresql.html#step-1-initialize-the-database-cluster-and-start-the-server"><i class="fa fa-check"></i><b>5.1</b> Step 1: Initialize the database cluster and start the server</a></li>
<li class="chapter" data-level="5.2" data-path="configuring-postgresql.html"><a href="configuring-postgresql.html#step-2-enable-password-authentication-for-all-users-other-than-postgres"><i class="fa fa-check"></i><b>5.2</b> Step 2: Enable password authentication for all users other than postgres</a></li>
<li class="chapter" data-level="5.3" data-path="configuring-postgresql.html"><a href="configuring-postgresql.html#step-3-create-a-new-role-and-new-database-for-betydb"><i class="fa fa-check"></i><b>5.3</b> Step 3: Create a new role and new database for BETYdb</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="archived-setup-documentation.html"><a href="archived-setup-documentation.html"><i class="fa fa-check"></i><b>6</b> Archived Setup Documentation</a><ul>
<li class="chapter" data-level="6.1" data-path="archived-setup-documentation.html"><a href="archived-setup-documentation.html#setting-up-a-redhat-or-centos-server"><i class="fa fa-check"></i><b>6.1</b> Setting up a RedHat or CentOS Server</a><ul>
<li class="chapter" data-level="6.1.1" data-path="archived-setup-documentation.html"><a href="archived-setup-documentation.html#overview"><i class="fa fa-check"></i><b>6.1.1</b> Overview</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="archived-setup-documentation.html"><a href="archived-setup-documentation.html#instructions-for-installing-and-configuring-postgresql"><i class="fa fa-check"></i><b>6.2</b> Instructions for Installing and Configuring PostgreSQL</a></li>
<li class="chapter" data-level="6.3" data-path="archived-setup-documentation.html"><a href="archived-setup-documentation.html#installing-the-betydb-rails-application"><i class="fa fa-check"></i><b>6.3</b> Installing the BETYdb Rails Application</a><ul>
<li class="chapter" data-level="6.3.1" data-path="archived-setup-documentation.html"><a href="archived-setup-documentation.html#prerequisites"><i class="fa fa-check"></i><b>6.3.1</b> Prerequisites</a></li>
<li class="chapter" data-level="6.3.2" data-path="archived-setup-documentation.html"><a href="archived-setup-documentation.html#installing-the-rails-application"><i class="fa fa-check"></i><b>6.3.2</b> Installing the Rails Application</a></li>
<li class="chapter" data-level="6.3.3" data-path="archived-setup-documentation.html"><a href="archived-setup-documentation.html#updating-syncing-the-database"><i class="fa fa-check"></i><b>6.3.3</b> Updating / Syncing the database</a></li>
<li class="chapter" data-level="6.3.4" data-path="archived-setup-documentation.html"><a href="archived-setup-documentation.html#starting-the-betydb-rails-web-application"><i class="fa fa-check"></i><b>6.3.4</b> Starting the BETYdb Rails Web Application</a></li>
<li class="chapter" data-level="6.3.5" data-path="archived-setup-documentation.html"><a href="archived-setup-documentation.html#logrotation"><i class="fa fa-check"></i><b>6.3.5</b> Logrotation</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III BETYdb System Administration</b></span></li>
<li class="chapter" data-level="7" data-path="updating-betydb-when-new-versions-are-released.html"><a href="updating-betydb-when-new-versions-are-released.html"><i class="fa fa-check"></i><b>7</b> Updating BETYdb When New Versions are Released</a><ul>
<li class="chapter" data-level="7.1" data-path="updating-betydb-when-new-versions-are-released.html"><a href="updating-betydb-when-new-versions-are-released.html#updating-the-bety-database"><i class="fa fa-check"></i><b>7.1</b> Updating the BETY database</a></li>
<li class="chapter" data-level="7.2" data-path="updating-betydb-when-new-versions-are-released.html"><a href="updating-betydb-when-new-versions-are-released.html#update-the-rails-app-and-schema"><i class="fa fa-check"></i><b>7.2</b> Update the Rails app and schema</a></li>
<li class="chapter" data-level="7.3" data-path="updating-betydb-when-new-versions-are-released.html"><a href="updating-betydb-when-new-versions-are-released.html#load-a-fresh-version-of-database"><i class="fa fa-check"></i><b>7.3</b> Load a fresh version of database</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="distributed-instances-of-betydb.html"><a href="distributed-instances-of-betydb.html"><i class="fa fa-check"></i><b>8</b> Distributed instances of BETYdb</a><ul>
<li class="chapter" data-level="8.1" data-path="distributed-instances-of-betydb.html"><a href="distributed-instances-of-betydb.html#syncing-databases"><i class="fa fa-check"></i><b>8.1</b> Syncing Databases</a><ul>
<li class="chapter" data-level="8.1.1" data-path="distributed-instances-of-betydb.html"><a href="distributed-instances-of-betydb.html#exporting-data"><i class="fa fa-check"></i><b>8.1.1</b> Exporting Data</a></li>
<li class="chapter" data-level="8.1.2" data-path="distributed-instances-of-betydb.html"><a href="distributed-instances-of-betydb.html#importing-data"><i class="fa fa-check"></i><b>8.1.2</b> Importing Data</a></li>
<li class="chapter" data-level="8.1.3" data-path="distributed-instances-of-betydb.html"><a href="distributed-instances-of-betydb.html#primary-key-allocations"><i class="fa fa-check"></i><b>8.1.3</b> Primary Key Allocations</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="distributed-instances-of-betydb.html"><a href="distributed-instances-of-betydb.html#feedback-tab"><i class="fa fa-check"></i><b>8.2</b> Feedback Tab</a></li>
<li class="chapter" data-level="8.3" data-path="distributed-instances-of-betydb.html"><a href="distributed-instances-of-betydb.html#customization"><i class="fa fa-check"></i><b>8.3</b> Customization</a></li>
<li class="chapter" data-level="8.4" data-path="distributed-instances-of-betydb.html"><a href="distributed-instances-of-betydb.html#issues"><i class="fa fa-check"></i><b>8.4</b> Issues</a></li>
</ul></li>
<li class="part"><span><b>IV BETYdb Development</b></span></li>
<li class="chapter" data-level="9" data-path="ruby-on-rails-application-overview-draft.html"><a href="ruby-on-rails-application-overview-draft.html"><i class="fa fa-check"></i><b>9</b> Ruby on Rails Application Overview (draft)</a><ul>
<li class="chapter" data-level="9.1" data-path="ruby-on-rails-application-overview-draft.html"><a href="ruby-on-rails-application-overview-draft.html#introduction-to-ruby-on-rails"><i class="fa fa-check"></i><b>9.1</b> Introduction to Ruby-on-Rails</a></li>
<li class="chapter" data-level="9.2" data-path="ruby-on-rails-application-overview-draft.html"><a href="ruby-on-rails-application-overview-draft.html#introduction-to-mvc"><i class="fa fa-check"></i><b>9.2</b> Introduction to MVC</a></li>
<li class="chapter" data-level="9.3" data-path="ruby-on-rails-application-overview-draft.html"><a href="ruby-on-rails-application-overview-draft.html#source-code-map"><i class="fa fa-check"></i><b>9.3</b> Source Code Map</a></li>
<li class="chapter" data-level="9.4" data-path="ruby-on-rails-application-overview-draft.html"><a href="ruby-on-rails-application-overview-draft.html#misc.-information"><i class="fa fa-check"></i><b>9.4</b> Misc. Information</a><ul>
<li class="chapter" data-level="9.4.1" data-path="ruby-on-rails-application-overview-draft.html"><a href="ruby-on-rails-application-overview-draft.html#providing-model-output-for-download"><i class="fa fa-check"></i><b>9.4.1</b> Providing model output for download</a></li>
<li class="chapter" data-level="9.4.2" data-path="ruby-on-rails-application-overview-draft.html"><a href="ruby-on-rails-application-overview-draft.html#related-issues-commits"><i class="fa fa-check"></i><b>9.4.2</b> Related Issues / Commits:</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="ruby-on-rails-developing-upgrading-and-deploying.html"><a href="ruby-on-rails-developing-upgrading-and-deploying.html"><i class="fa fa-check"></i><b>10</b> Ruby-on-Rails: Developing, Upgrading, and Deploying</a><ul>
<li class="chapter" data-level="10.1" data-path="ruby-on-rails-developing-upgrading-and-deploying.html"><a href="ruby-on-rails-developing-upgrading-and-deploying.html#development-and-testing"><i class="fa fa-check"></i><b>10.1</b> Development and Testing</a></li>
<li class="chapter" data-level="10.2" data-path="ruby-on-rails-developing-upgrading-and-deploying.html"><a href="ruby-on-rails-developing-upgrading-and-deploying.html#deploying-a-new-version"><i class="fa fa-check"></i><b>10.2</b> Deploying a new version:</a></li>
<li class="chapter" data-level="10.3" data-path="ruby-on-rails-developing-upgrading-and-deploying.html"><a href="ruby-on-rails-developing-upgrading-and-deploying.html#deploying-or-upgrading-to-a-new-version-of-the-betydb-rails-app"><i class="fa fa-check"></i><b>10.3</b> Deploying or upgrading to a new version of the BETYdb Rails app</a><ul>
<li class="chapter" data-level="10.3.1" data-path="ruby-on-rails-developing-upgrading-and-deploying.html"><a href="ruby-on-rails-developing-upgrading-and-deploying.html#running-migrations"><i class="fa fa-check"></i><b>10.3.1</b> Running Migrations</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="ruby-on-rails-developing-upgrading-and-deploying.html"><a href="ruby-on-rails-developing-upgrading-and-deploying.html#versioning-and-tagging"><i class="fa fa-check"></i><b>10.4</b> Versioning and Tagging</a><ul>
<li class="chapter" data-level="10.4.1" data-path="ruby-on-rails-developing-upgrading-and-deploying.html"><a href="ruby-on-rails-developing-upgrading-and-deploying.html#protocol-for-defining-and-releasing-versions"><i class="fa fa-check"></i><b>10.4.1</b> Protocol for defining and releasing versions</a></li>
<li class="chapter" data-level="10.4.2" data-path="ruby-on-rails-developing-upgrading-and-deploying.html"><a href="ruby-on-rails-developing-upgrading-and-deploying.html#version-numbering"><i class="fa fa-check"></i><b>10.4.2</b> Version Numbering</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="ruby-on-rails-developing-upgrading-and-deploying.html"><a href="ruby-on-rails-developing-upgrading-and-deploying.html#commenting-in-the-rails-models"><i class="fa fa-check"></i><b>10.5</b> Commenting in the Rails Models</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="automated-tests.html"><a href="automated-tests.html"><i class="fa fa-check"></i><b>11</b> Automated Tests</a><ul>
<li class="chapter" data-level="11.1" data-path="automated-tests.html"><a href="automated-tests.html#development-and-testing-1"><i class="fa fa-check"></i><b>11.1</b> Development and Testing</a></li>
<li class="chapter" data-level="11.2" data-path="automated-tests.html"><a href="automated-tests.html#running-the-rspec-tests-on-betydb."><i class="fa fa-check"></i><b>11.2</b> Running the RSpec tests on BETYdb.</a><ul>
<li class="chapter" data-level="11.2.1" data-path="automated-tests.html"><a href="automated-tests.html#preparing-the-test-database."><i class="fa fa-check"></i><b>11.2.1</b> Preparing the test database.</a></li>
<li class="chapter" data-level="11.2.2" data-path="automated-tests.html"><a href="automated-tests.html#running-the-tests"><i class="fa fa-check"></i><b>11.2.2</b> Running the tests</a></li>
<li class="chapter" data-level="11.2.3" data-path="automated-tests.html"><a href="automated-tests.html#troubleshooting"><i class="fa fa-check"></i><b>11.2.3</b> Troubleshooting</a></li>
<li class="chapter" data-level="11.2.4" data-path="automated-tests.html"><a href="automated-tests.html#creating-a-new-postgis-enabled-database-template"><i class="fa fa-check"></i><b>11.2.4</b> Creating a new PostGIS-enabled database template</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="code-style.html"><a href="code-style.html"><i class="fa fa-check"></i><b>12</b> Code Style</a><ul>
<li class="chapter" data-level="12.1" data-path="code-style.html"><a href="code-style.html#whitespace-conventions-in-the-betydb-code"><i class="fa fa-check"></i><b>12.1</b> Whitespace conventions in the BETYdb Code</a></li>
<li class="chapter" data-level="12.2" data-path="code-style.html"><a href="code-style.html#fixing-legacy-formatting"><i class="fa fa-check"></i><b>12.2</b> Fixing legacy formatting</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="complex-joins-in-the-web-interface.html"><a href="complex-joins-in-the-web-interface.html"><i class="fa fa-check"></i><b>13</b> Complex Joins in the Web Interface</a></li>
<li class="chapter" data-level="14" data-path="database-constraints.html"><a href="database-constraints.html"><i class="fa fa-check"></i><b>14</b> Database Constraints</a><ul>
<li class="chapter" data-level="14.1" data-path="database-constraints.html"><a href="database-constraints.html#types-of-constraints"><i class="fa fa-check"></i><b>14.1</b> Types of Constraints</a></li>
<li class="chapter" data-level="14.2" data-path="database-constraints.html"><a href="database-constraints.html#value-constraints-including-some-not-null-constraints"><i class="fa fa-check"></i><b>14.2</b> Value Constraints (including some NOT NULL constraints)</a><ul>
<li class="chapter" data-level="" data-path="database-constraints.html"><a href="database-constraints.html#global"><i class="fa fa-check"></i>Global</a></li>
<li class="chapter" data-level="" data-path="database-constraints.html"><a href="database-constraints.html#covariates-1"><i class="fa fa-check"></i>covariates:</a></li>
<li class="chapter" data-level="" data-path="database-constraints.html"><a href="database-constraints.html#managements-1"><i class="fa fa-check"></i>managements:</a></li>
<li class="chapter" data-level="" data-path="database-constraints.html"><a href="database-constraints.html#species"><i class="fa fa-check"></i>species:</a></li>
<li class="chapter" data-level="" data-path="database-constraints.html"><a href="database-constraints.html#sites-1"><i class="fa fa-check"></i>sites:</a></li>
<li class="chapter" data-level="" data-path="database-constraints.html"><a href="database-constraints.html#traits-1"><i class="fa fa-check"></i>traits:</a></li>
<li class="chapter" data-level="" data-path="database-constraints.html"><a href="database-constraints.html#treatments-1"><i class="fa fa-check"></i>treatments:</a></li>
<li class="chapter" data-level="" data-path="database-constraints.html"><a href="database-constraints.html#users"><i class="fa fa-check"></i>users:</a></li>
<li class="chapter" data-level="" data-path="database-constraints.html"><a href="database-constraints.html#yields-see-also-traits-constraints"><i class="fa fa-check"></i>yields: [see also traits constraints]</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="database-constraints.html"><a href="database-constraints.html#foreign-key-constraints"><i class="fa fa-check"></i><b>14.3</b> Foreign Key Constraints</a></li>
<li class="chapter" data-level="14.4" data-path="database-constraints.html"><a href="database-constraints.html#non-null-constraints"><i class="fa fa-check"></i><b>14.4</b> Non Null Constraints</a></li>
<li class="chapter" data-level="14.5" data-path="database-constraints.html"><a href="database-constraints.html#uniqueness-constraints"><i class="fa fa-check"></i><b>14.5</b> Uniqueness constraints</a></li>
<li class="chapter" data-level="14.6" data-path="database-constraints.html"><a href="database-constraints.html#technical-note"><i class="fa fa-check"></i><b>14.6</b> Technical Note</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="modifying-the-betydb-schema.html"><a href="modifying-the-betydb-schema.html"><i class="fa fa-check"></i><b>15</b> Modifying the BETYdb schema</a><ul>
<li class="chapter" data-level="15.1" data-path="modifying-the-betydb-schema.html"><a href="modifying-the-betydb-schema.html#modifying-bety-troubleshooting"><i class="fa fa-check"></i><b>15.1</b> Troubleshooting</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="issuing-a-new-release.html"><a href="issuing-a-new-release.html"><i class="fa fa-check"></i><b>16</b> Issuing a New Release</a><ul>
<li class="chapter" data-level="16.1" data-path="issuing-a-new-release.html"><a href="issuing-a-new-release.html#writing-release-notes"><i class="fa fa-check"></i><b>16.1</b> Writing release notes</a></li>
<li class="chapter" data-level="16.2" data-path="issuing-a-new-release.html"><a href="issuing-a-new-release.html#upgrading-the-canonical-betydb-rails-sitecanonical_site"><i class="fa fa-check"></i><b>16.2</b> Upgrading the canonical BETYdb Rails site</a></li>
<li class="chapter" data-level="16.3" data-path="issuing-a-new-release.html"><a href="issuing-a-new-release.html#upgrading-other-production-sites"><i class="fa fa-check"></i><b>16.3</b> Upgrading other production sites</a></li>
<li class="chapter" data-level="16.4" data-path="issuing-a-new-release.html"><a href="issuing-a-new-release.html#finishing-the-release"><i class="fa fa-check"></i><b>16.4</b> Finishing the release</a><ul>
<li class="chapter" data-level="16.4.1" data-path="issuing-a-new-release.html"><a href="issuing-a-new-release.html#version-numbering-1"><i class="fa fa-check"></i><b>16.4.1</b> Version Numbering</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>V Appendix</b></span></li>
<li class="chapter" data-level="" data-path="release-notes-template.html"><a href="release-notes-template.html"><i class="fa fa-check"></i>Release Notes Template</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="archived-setup-documentation" class="section level1">
<h1><span class="header-section-number">6</span> Archived Setup Documentation</h1>
<p>These pages are being kept temporarily for reference. Much of what is here is superceded by the preceding setup documentation.</p>
<div id="setting-up-a-redhat-or-centos-server" class="section level2">
<h2><span class="header-section-number">6.1</span> Setting up a RedHat or CentOS Server</h2>
<div id="overview" class="section level3">
<h3><span class="header-section-number">6.1.1</span> Overview</h3>
<p>BETYdb runs on RedHat, CentOS, Ubuntu and OSX; instructions for installing on these systems can be found in the <a href="https://pecanproject.github.io/pecan-documentation/master/" target="_blank">PEcAn documentation</a>.</p>
<p>The original BETYdb (betydb.org) runs on a Red Hat Enterprise Linux version 5.8 Server. To simulate this environment, we have set up a CentOS 5.8 server at pecandev.igb.illinois.edu for testing.</p>
<p>This documentation is aimed at installing BETYdb on a production RedHat, CentOS or similar operating system.</p>
<p>These instructions have been tested and refined on our production (ebi-forecast.igb.illinois.edu) and development (pecandev.igb.illinois.edu) servers. See the <a href="https://pecanproject.github.io/pecan-documentation/master/pecan-setup.html#installing-bety" target="_blank">Installing BETY</a> section of the PEcAn documentation for more generic installation instructions.</p>
<p>If you have any questions about installing BETYdb … please <a href="https://github.com/pecanproject/bety/issues/new" target="_blank">submit an issue</a> or <a href="mailto:betydb@gmail.com">send an email</a>.</p>
<div id="create-an-netinstall-of-the-centos-iso" class="section level4">
<h4><span class="header-section-number">6.1.1.1</span> Create an netinstall of the CentOS ISO</h4>
</div>
<div id="boot-from-cd-and-install" class="section level4">
<h4><span class="header-section-number">6.1.1.2</span> Boot from CD and Install</h4>
<ul>
<li>Following instructions here: <a href="http://www.if-not-true-then-false.com/2010/centos-netinstall-network-installation/" class="uri" target="_blank">http://www.if-not-true-then-false.com/2010/centos-netinstall-network-installation/</a></li>
<li>Download this iso: <a href="http://vault.centos.org/5.8/isos/x86_64/CentOS-5.8-x86_64-netinstall.iso" class="uri" target="_blank">http://vault.centos.org/5.8/isos/x86_64/CentOS-5.8-x86_64-netinstall.iso</a></li>
<li>it is the “netinstall” version, small enough to fit on a CD, but requires internet to install</li>
<li>burn to CD</li>
<li>boot from CD</li>
<li>ftp server: <code>vault.centos.org</code></li>
<li>directory: <code>/centos/5.8/os/x86_64</code></li>
</ul>
</div>
<div id="configuration" class="section level4">
<h4><span class="header-section-number">6.1.1.3</span> Configuration</h4>
<ol style="list-style-type: decimal">
<li>Add new user <code>adduser johndoe</code></li>
<li>add user to root <code>sudo su emacs /etc/sudoers</code></li>
<li><p>add the line</p>
<pre><code>johndoe  ALL=(ALL)  ALL</code></pre></li>
</ol>
</div>
<div id="add-new-repository" class="section level4">
<h4><span class="header-section-number">6.1.1.4</span> Add new repository</h4>
<p>instructions here: <a href="http://www.rackspace.com/knowledge_center/article/installing-rhel-epel-repo-on-centos-5x-or-6x" class="uri" target="_blank">http://www.rackspace.com/knowledge_center/article/installing-rhel-epel-repo-on-centos-5x-or-6x</a></p>
<pre><code>wget http://dl.fedoraproject.org/pub/epel/5/x86_64/epel-release-5-4.noarch.rpm
sudo rpm -Uvh epel-release-5*.rpm</code></pre>
<p>… move to PEcAn documentation page for build environment</p>
<p><a href="https://pecanproject.github.io/pecan-documentation/master/pecan-setup.html#installing-bety" class="uri" target="_blank">https://pecanproject.github.io/pecan-documentation/master/pecan-setup.html#installing-bety</a></p>
<p>Remember to install R 3.0:</p>
<pre><code>wget http://cran.us.r-project.org/src/base/R-3/R-3.0.1.tar.gz
tar xzf R-3.0.1.tar.gz
cd R-3.0.1
./configure
make
sudo make install</code></pre>
</div>
<div id="site-data-installation" class="section level4">
<h4><span class="header-section-number">6.1.1.5</span> Site data installation</h4>
<pre><code>cd /usr/local/ebi

rm -rf sites
curl -o sites.tgz http://isda.ncsa.illinois.edu/~kooper/EBI/sites.tgz
tar zxf sites.tgz
sed -i -e &quot;s#/home/kooper/projects/EBI#${PWD}#&quot; sites/*/ED_MET_DRIVER_HEADER
rm sites.tgz

rm -rf inputs
wget http://isda.ncsa.illinois.edu/~kooper/EBI/inputs.tgz
tar zxf inputs.tgz
rm inputs.tgz</code></pre>
</div>
<div id="database-creation" class="section level4">
<h4><span class="header-section-number">6.1.1.6</span> Database Creation</h4>
<p>See the <a href="https://pecanproject.github.io/pecan-documentation/master/" target="_blank">PEcAn documentation</a> for additional information, e.g. on the scripts (<a href="https://github.com/PecanProject/pecan/blob/master/scripts/load.bety.sh" target="_blank">load.bety.sh</a> is in the PEcAn repo), running the rails and/or php front-ends</p>
<pre><code># install database (code assumes password is bety)
sudo -u postgres createuser -d -l -P -R -S bety
sudo -u postgres createdb -O bety bety
sudo -u postgres CREATE=YES REMOTESITE=0 scripts/load.bety.sh
REMOTESITE=1 scripts/load.bety.sh</code></pre>
<p>Open up <code>updatedb.sh</code> and remove the two lines</p>
<pre><code>#change to home
cd</code></pre>
<p>If these are left in, the script will attempt to put the site data in ~/sites instead of /usr/local/ebi/sites.</p>
<pre><code>#fetch and updates the bety database
./updatedb.sh</code></pre>
</div>
<div id="ruby-installation" class="section level4">
<h4><span class="header-section-number">6.1.1.7</span> Ruby installation</h4>
<p>The version of ruby available through yum is too low, so we have to use rvm</p>
<pre><code>user$ \curl -L https://get.rvm.io | sudo bash -s stable
rvm install 1.9
rvm use 1.9

yum upgrade rubygem

yum install mysql-devel.x86_64
yum install ImageMagick-devel.x86_64
yum install rubygem-rails
yum install httpd-devel
wget http://www.sqlite.org/2013/sqlite-autoconf-3071700.tar.gz
tar -xzf sqlite-autoconf-3071700.tar.gz
cd sqlite-autoconf-3071700.tar.gz
./configure
make
make install</code></pre>
<p>If you plan to run the JavaScript-based rspec tests, you will also need to install qt:</p>
<pre><code>wget http://download.qt-project.org/official_releases/qt/4.8/4.8.6/qt-everywhere-opensource-src-4.8.6.tar.gz
tar -xf qt-everywhere-opensource-src-4.8.6.tar.gz
cd qt-everywhere-opensource-src-4.8.6
./configure --prefix=/usr/local/qt-4.8.6
make
make install

export PATH=/usr/local/qt-4.8.6/bin:$PATH
export PATH=/usr/local/ruby-1.8.3/bin:$PATH
# Before running the &quot;gem&quot; command, type &quot;gem environment&quot; and make sure the installation directory matches
# the installation directory used by the BetyDB Rail application.  If you are using RVM, it should suffice
# simply to switch the the root directory of the application, e.g. &quot;cd /usr/local/ebi&quot;.
gem install capybara-webkit</code></pre>
<p>Then all the ruby gems bety needs.</p>
<pre><code>cd /usr/local/bety
gem install bundler
bundle install
# (If you didn&#39;t install qt and capybara-webkit, you will need to run &quot;bundle install --without test_js&quot; instead.)</code></pre>
<p>Configuration for Bety:</p>
<pre><code>cd /usr/local/ebi/bety

# create folders for upload folders
mkdir paperclip/files paperclip/file_names
chmod 777 paperclip/files paperclip/file_names

# create folder for log files
mkdir log
touch log/production.log
chmod 0666 log/production.log
touch log/test.log
chmod 0666 log/test.log

cat &gt; config/database.yml &lt;&lt; EOF
production:
  adapter: mysql2
  encoding: latin1
  reconnect: false
  database: bety
  pool: 5
  username: bety
  password: bety

test:
  adapter: mysql2
  encoding: latin1
  reconnect: false
  database: test
  pool: 5
  username: bety
  password: bety
EOF


# setup per-instance configuration
cp config/application.yml.template config/application.yml
# Be sure to edit the sample values in application.yml to provide values appropriate to your server.
# In particular, the actual value for rest_auth_site_key needs to be replaced with one matching the DB you are using.



# configure apache
ln -s /usr/local/ebi/bety/public /var/www/bety

cat &gt; /etc/apache2/conf.d/bety &lt;&lt; EOF
RailsEnv production
RailsBaseURI /bety
&lt;Directory /var/www/bety&gt;
   Options FollowSymLinks
   AllowOverride None
   Order allow,deny
   Allow from all
&lt;/Directory&gt;
EOF</code></pre>
<p>You may have to change your DocumentRoot in /etc/httpd/conf/httpd.conf from “/var/www/html” to “/var/www” if you get the error message ‘Passenger error #2 An error occurred while trying to access’/var/www/html/bety’: Cannot resolve possible symlink ‘/var/www/html/bety’: No such file or directory (2)’. Up next make apache2 and passenger play nicely:</p>
<pre><code>rvmsudo passenger-install-apache2-module</code></pre>
<p>If that fails, try</p>
<pre><code>sudo -s
source `rvm gemdir`</code></pre>
<p>Finally run the tests</p>
<pre><code>cd /usr/local/eby/bety/
bundle exec rake db:test:prepare &amp;&amp; bundle exec rake db:fixtures:load RAILS_ENV=test &amp;&amp; bundle exec rspec spec/</code></pre>
<p>[Note: If you are using RVM version 1.11 or later, you can omit the “bundle exec” portion of all rake and rspec commands. For example, the command above could just be typed as <code>rake db:test:prepare &amp;&amp; rake db:fixtures:load RAILS_ENV=test &amp;&amp; rspec spec/</code>]</p>

</div>
</div>
</div>
<div id="instructions-for-installing-and-configuring-postgresql" class="section level2">
<h2><span class="header-section-number">6.2</span> Instructions for Installing and Configuring PostgreSQL</h2>
<p>These instructions are for installation on Ubuntu. For other Linux-like systems, the steps are similar. Mainly the file locations and the installation command (<code>apt-get</code> here) will be different.</p>
<ol style="list-style-type: decimal">
<li>Run <code>sudo apt-get install postgresql</code>.</li>
<li>Create user bety: Run <code>sudo -u postgres createuser -P bety</code>. Type <code>bety</code> when prompted for a password. This is the default user the the BetyDB Rails application connects to the database as.</li>
<li>[Optional:] If you wish to administer the database without switching to user postgres (so that you don’t have to prefix all your commands with <code>sudo -u postgres</code>) add yourself as a superuser: <code>sudo -u postgres createuser -s &lt;your_ubuntu_login_name&gt;</code>. This will allow you to run all PostgreSQL commands as yourself without a password.</li>
<li><p>Edit the pg_hba.conf file to allow bety to log in using a password. On Ubuntu, this file is most likely located at <code>/etc/postgresql/9.3/main/pg_hba.conf</code> (assuming you are using version 9.3). In detail:</p>
<pre><code>sudo su # this allows accessing and editing the conf file
cd /etc/postgresql/9.3/main
cp pg_hba.conf pg_hba.conf-original # optional convenience if you need to start over
emacs pg_hba.conf # use your favorite editor</code></pre>
In this file, you will see a line like this <code>local       all       all      peer</code> Assuming this is a fresh install of PostgreSQL, you can give password access to user bety by adding the line <code>local       bety      bety     md5</code> immediately <em>before</em> this. Then save the file.</li>
<li>In order for the configuration to take effect, you must reload the config files: <code>sudo /etc/init.d/postgresql reload</code></li>
<li><p>You can test that user bety exists and can log in by running the following:</p>
<pre><code>sudo -u postgres createdb -O bety bety
psql -U bety</code></pre></li>
</ol>
<div id="manually-dumping-and-installing-betydb" class="section level4">
<h4><span class="header-section-number">6.2.0.1</span> Manually dumping and installing BETYdb</h4>
<p>In this example, we are dumping BETY from “betyhost” to “myserver”</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="fu">ssh</span> betyhost
<span class="ex">pg_dump</span> -U postgres bety <span class="op">&gt;</span> bety_YYYYMMDD.sql
<span class="fu">rsync</span> bety_YYYYMMDD.sql myserver:  </code></pre></div>
<div id="create-copy-of-bety" class="section level5">
<h5><span class="header-section-number">6.2.0.1.1</span> Create Copy of BETY</h5>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="fu">ssh</span> myserver
<span class="ex">createdb</span> -U postgres bety_copy</code></pre></div>
</div>
<div id="enable-postgis" class="section level5">
<h5><span class="header-section-number">6.2.0.1.2</span> Enable PostGIS</h5>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="ex">psql</span> -U postgres
<span class="va">postgres=</span># \<span class="ex">c</span> bety_copy
<span class="va">postgres=</span># <span class="ex">CREATE</span> EXTENSION POSTGIS<span class="kw">;</span></code></pre></div>
<p>Also see <a href="automated-tests.html#creating-a-new-postgis-enabled-database-template">Creating a new PostGIS-enabled database template</a>.</p>
</div>
<div id="import-database" class="section level5">
<h5><span class="header-section-number">6.2.0.1.3</span> Import database</h5>
<pre class="shell"><code>psql -U postgres bety_copy &lt; bety_YYYYMMDD.sql</code></pre>

</div>
</div>
</div>
<div id="installing-the-betydb-rails-application" class="section level2">
<h2><span class="header-section-number">6.3</span> Installing the BETYdb Rails Application</h2>
<p><em>Note:</em> This guide is aimed at Rails developers and testers. If you are a Pecan developer, you may want to use the notes in the <a href="https://pecanproject.github.io/pecan-documentation/master/pecan-setup.html#installing-bety" target="_blank">PEcAn documentation</a> instead of or in addition to the notes below.</p>
<p><em>quick start</em> The install_pecan.sh script contains <a href="https://github.com/PecanProject/pecan/blob/master/scripts/install_pecan.sh#L398" target="_blank">steps used to create a Virtual Machine on line 398</a> and <a href="https://github.com/PecanProject/pecan/blob/master/scripts/install_pecan.sh#L102" target="_blank">dependencies for different OS’s on line 102</a></p>
<div id="prerequisites" class="section level3">
<h3><span class="header-section-number">6.3.1</span> Prerequisites</h3>
<ol style="list-style-type: decimal">
<li>Git</li>
<li>Ruby 2.1.5 (Anything later than version 1.9.3 will probably work, but 2.1.5 is the officially supported version.) If you are doing Rails development or if you are using Ruby for outside of BETYdb, you may want to install RVM so that you can easily switch between Rails versions and Gem sets.</li>
<li>PostgreSQL with the PostGIS extension (see <a href="archived-setup-documentation.html#instructions-for-installing-and-configuring-postgresql">Instructions for Installing and Configuring PostgreSQL</a> for information on installing and configuring PostgreSQL)</li>
<li>Apache web server (optional; developers in particular can simply use the built-in Rails server)</li>
</ol>
<p>In addition, the scripts below assume you have a working Bash shell. (Windows users might be able to use Cygwin or some other some other port of Linux tools.)</p>
</div>
<div id="installing-the-rails-application" class="section level3">
<h3><span class="header-section-number">6.3.2</span> Installing the Rails Application</h3>
<div id="installing-the-rails-code-and-ruby-gems" class="section level4">
<h4><span class="header-section-number">6.3.2.1</span> Installing the Rails code and Ruby Gems</h4>
<p>Run these commands to get the Rails code and the Ruby Gems that it uses:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash">
<span class="co"># This can be any place you have write permissions for, probably something under your home directory:</span>
<span class="va">INSTALLATION_DIRECTORY=</span>~/projects

<span class="co"># install bety</span>
<span class="bu">cd</span> <span class="va">$INSTALLATION_DIRECTORY</span>

<span class="co"># Developers who will be submitting Git pull requests should make a fork of bety.git on GitHub and then</span>
<span class="co"># replace the URL below with the address of their own copy:</span>
<span class="fu">git</span> clone https://github.com/PecanProject/bety.git

<span class="co"># install gems</span>
<span class="bu">cd</span> bety
<span class="ex">gem</span> install bundler <span class="co"># not needed if you already have bundler</span>
<span class="ex">bundle</span> install <span class="co"># Use the --without option to avoid installing certain groups of Gems; see below.</span>
<span class="bu">exit</span></code></pre></div>
<p>[Note: If you can’t or don’t wish to install the capybara-webkit gem, you can comment it out in the Gemfile before running bundle install.</p>
<p>Note: If you receive “checking for pg_config… no” and the associated errors then you may need update build.pg using the “bundle config” command. For example, to update the bundle executable with the location of the pg_config command you can run: <em>bundle config build.pg –with-pg-config=/usr/pgsql-9.4/bin/pg_config</em> This assumes your pg_config is located at <em>/usr/pgsql-9.4/bin/</em>. Update this path as necessary for your local PostgreSQL/Postgis install]</p>
<div id="minimizing-gem-installation" class="section level5">
<h5><span class="header-section-number">6.3.2.1.1</span> Minimizing Gem Installation</h5>
<p>Certain Ruby Gems are difficult or time-consuming to install on certain platforms, and if they are not essential to your work, you may wish to avoid installing them. (If this isn’t a concern, you may skip this section.)</p>
<p>If you look at the Gemfile in the root directory of the BETYdb Rails code, you will see the certain Gems are specified within <em>group</em> blocks; this means they are intended to be used only in certain contexts. If you don’t intend to use BETYdb within those contexts, you may safely use the <code>--without</code> option to <code>bundle install</code> to exclude the Gems used only in those contexts.</p>
<p>As an example, the passenger Gem is used only in the production environment. Therefore, it is in a <code>production</code> group within the Gemfile. If you run</p>
<pre><code>bundle install --without=production</code></pre>
<p>the bundler will skip installation of passenger.</p>
<p>Moreover, this is a “remembered” option: the next time you run <code>bundle install</code>, it will remember not to install production-only Gems even if you haven’t specified the <code>--without</code> option. Furthermore, this “remembered option” is also respected by WEBrick, the default Rails server, so it won’t complain that you didn’t install the passenger Gem.</p>
<p>As another example, the <code>capybara-webkit</code> Gem is difficult and time-consuming to install on some platforms, and unless you are running the RSpec tests, you can do without it. (In fact, even if you <em>are</em> running RSpec tests, most of the tests don’t use <code>capybara-webkit</code>, and for those that do, you can either skip them or tell them to use <code>selenium-webdriver</code> instead.)</p>
<p><code>capybara-webkit</code> is in a group called <code>javascript_testing</code>, so to avoid installing it, run</p>
<pre><code>bundle install --without=javascript_testing</code></pre>
<p>To see what the remembered “without” options are, run</p>
<pre><code>bundle config</code></pre>
<p>You can also use <code>bundle config</code> to specify directly what groups Bundler should skip. For example, to tell Bundler to ignore all groups except the production group, pass a colon-separated list containing all of the <em>other</em> groups to <code>bundle config --local without</code>:</p>
<pre><code>bundle config --local without development:test:javascript_testing:debug</code></pre>
<p>To revert to installing everything when you run <code>bundle install</code>, remove the <code>without</code> setting from the configuration with</p>
<pre><code>bundle config --delete without</code></pre>
</div>
</div>
<div id="configuring-rails" class="section level4">
<h4><span class="header-section-number">6.3.2.2</span> Configuring Rails</h4>
<p>Configure the BETYdb Rails application using the following commands:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="bu">cd</span> <span class="va">$INSTALLATION_DIRECTORY</span>/bety

<span class="co"># setup bety database configuration</span>
<span class="fu">cat</span> <span class="op">&gt;</span> config/database.yml <span class="op">&lt;&lt; EOF</span>
development:
  adapter: postgis
  encoding: utf-8
  reconnect: false
  database: bety
  pool: 5
  username: bety
  password: bety
EOF

# Optional: Override some of the default configuration settings given in config/defaults.yml.
cp config/application.yml.template config/application.yml
# Read the comments in this file and set the variable values you are interested in; delete the other settings.
</code></pre></div>
</div>
<div id="installing-the-database" class="section level4">
<h4><span class="header-section-number">6.3.2.3</span> Installing the Database</h4>
<p><em><strong>Note</strong></em> To join the distributed network of databases, see the chapter <a href="distributed-instances-of-betydb.html#distributed-instances-of-betydb">Distributed instances of BETYdb</a>.</p>
<p>In the <code>script</code> directory of the bety Rails installation, find and run the update-betydb.sh script:</p>
<pre><code>./update-betydb.sh</code></pre>
<p>This script is a wrapper script for the script <code>load.bety.sh</code> from the Pecan project. The latter can be downloaded by running <code>update-betydb.sh</code> without options. Use the <code>-h</code> option for more information.</p>
</div>
</div>
<div id="updating-syncing-the-database" class="section level3">
<h3><span class="header-section-number">6.3.3</span> Updating / Syncing the database</h3>
<p>See instructions <a href="updating-betydb-when-new-versions-are-released.html#updating-the-bety-database">Updating the BETY database</a>.</p>
</div>
<div id="starting-the-betydb-rails-web-application" class="section level3">
<h3><span class="header-section-number">6.3.4</span> Starting the BETYdb Rails Web Application</h3>
<ol style="list-style-type: decimal">
<li>cd to the bety directory, the directory you cloned the Rails code to.</li>
<li>Run <code>rails s</code>.</li>
<li>You should now be able to visit the web application at <a href="http://localhost:3000" class="uri" target="_blank">http://localhost:3000</a>.</li>
<li>To log in, use <code>Login: carya</code>, <code>Password: illinois</code></li>
</ol>
</div>
<div id="logrotation" class="section level3">
<h3><span class="header-section-number">6.3.5</span> Logrotation</h3>
<p>To prevent the log files from growing to large it is recommended to use logrotation. This will rotate the logs (for example every week) and append <code>.1</code> etc. to the logfiles. The following can be used on an Ubuntu system.</p>
<p>Edit <code>/etc/logrotate.conf</code> and add the following snippet at the bottom (replacing /home/bety/bety with the actual path to the installation of bety):</p>
<pre><code>/home/bety/bety/log/*.log {
  daily
  missingok
  rotate 7
  compress
  delaycompress
  notifempty
  copytruncate
}</code></pre>
<p>Once this installed you can force a logrotate to happen (or wait till Sunday) by using: <code>sudo /usr/sbin/logrotate -f /etc/logrotate.conf</code></p>

</div>
</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="configuring-postgresql.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="updating-betydb-when-new-versions-are-released.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
